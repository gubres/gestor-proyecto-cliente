{% extends 'base.html.twig' %}

{% block title %}Perfil del Usuario{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.datatables.net/v/dt/jszip-3.10.1/dt-2.0.3/b-3.0.1/b-html5-3.0.1/b-print-3.0.1/sl-2.0.0/datatables.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.10.0/js/bootstrap-datepicker.min.js">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
{% endblock %}

{% block body %}
<div class="container mt-3">
    <h1 class="text-center">Perfil del Usuario</h1>
    <div class="card">
        <div class="card-body">
            <p><strong>ID:</strong> {{ usuario.id }}</p>
            <p><strong>Nombre:</strong> {{ usuario.nombre }}</p>
            <p><strong>Email:</strong> {{ usuario.email }}</p>
            <p><strong>Estado:</strong> {{ usuario.isActive ? 'Activo' : 'Inactivo' }}</p>
            <p><strong>Verificado:</strong> {{ usuario.isVerified ? 'SÃ­' : 'No' }}</p>
            <p><strong>Autorizaciones:</strong>
            {% set readableRoles = [] %}
            {% for role in usuario.getRoles() %}
                {% if role == 'ROLE_USER' %}
                    {% set readableRoles = readableRoles | merge(['NIVEL USUARIO']) %}
                {% elseif role == 'ROLE_ADMIN' %}
                    {% set readableRoles = readableRoles | merge(['NIVEL ADMINISTRADOR']) %}
                {% endif %}
            {% endfor %}
            {{ readableRoles | join(' Y ') }}
        </p>

            <a href="{{ path('app_usuarios_edit', {'id': usuario.id}) }}" class="btn btn-warning">Editar Perfil</a>
            <button type="button" class="btn btn-danger mx-3" data-bs-toggle="modal" data-bs-target="#deleteModal">
                Borrar Cuenta
            </button>


        </div>
    </div>
</div>

            {# modal de mensajes #}
        <div class="modal-body">
            {% include '/usuarios/modalUsuarios.html.twig' %}
        </div>
{% endblock %}

{% block javascripts %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const deleteButton = document.getElementById('confirmDeleteButton');
        deleteButton.addEventListener('click', function () {
            fetch('{{ path('app_usuarios_delete', {'id': usuario.id}) }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: '_token={{ csrf_token('delete' ~ usuario.id) }}'
            })
            .then(response => response.json())
            .then(data => {
                $('#deleteModal').modal('hide');
                if (data.success) {
                    $('#successModalText').text('El usuario ha sido eliminado.');
                    $('#successModal').modal('show');
                } else {
                    $('#errorModalText').text('Error al eliminar el usuario.');
                    $('#errorModal').modal('show');
                }
            })
            .catch(error => {
                $('#deleteModal').modal('hide');
                $('#errorModalText').text('Error al eliminar el usuario.');
                $('#errorModal').modal('show');
            });
        });
    });
</script>

{% endblock %}

