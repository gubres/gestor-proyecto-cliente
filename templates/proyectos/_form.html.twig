<!-- jQuery sin el atributo 'integrity' -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>

{{ form_start(form, { 'attr': {'id': 'form'} }) }}
    {{ form_row(form.nombre) }}
  
    {# Desplegable de clientes #}
    <div class="form-group">
        {{ form_label(form.Cliente) }}
        {{ form_widget(form.Cliente, {'attr': {'class': 'form-control'}}) }}
    </div>

    {# Botón para abrir el modal de crear nuevo cliente #}
    <button type="button" class="btn btn-primary mb-3" id="abrirModalNuevoCliente">Crear Nuevo Cliente</button>

    {{ form_row(form.Estado) }}


    {{ form_row(form.usuarios) }}

    {% if app.request.attributes.get('_route') == 'app_proyectos_edit' %}
        <button type="button" class="btn btn-success" id="guardarButton">{{ button_label|default('Guardar') }}</button>
    {% else %}
        <button class="btn btn-success">{{ button_label|default('Guardar') }}</button>
    {% endif %}
{{ form_end(form) }}

<!-- Modal para crear nuevo cliente -->
<div class="modal fade" id="nuevoClienteModal" tabindex="-1" role="dialog" aria-labelledby="modalTituloNuevoCliente" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTituloNuevoCliente">Crear Nuevo Cliente</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
           <div class="modal-body">
                <!-- Formulario para crear nuevo cliente -->
                {{ form_start(clienteForm, { 'attr': {'id': 'nuevoClienteForm'} }) }}
                {{ form_widget(clienteForm) }}
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="guardarClienteBtn">Guardar</button>
                {{ form_end(clienteForm) }}
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function() {
        // Evento de clic para abrir el modal de crear nuevo cliente
        $('#abrirModalNuevoCliente').click(function() {
            $('#nuevoClienteModal').modal('show');
        });

        // Evento de clic para guardar el nuevo cliente
        $('#guardarClienteBtn').click(function() {
            var nombreCliente = $('#nombreCliente').val(); // Obtener el nombre del cliente desde el formulario

            // Enviar el formulario mediante AJAX
            $.ajax({
                type: 'POST',
                url: '{{ path('app_clientes_new') }}', 
                // A PARTIR DE AQUÍ YA NO ME VA
                data: $('#nuevoClienteForm').serialize(), // Serializar el formulario
            
                success: function(response) {

                    console.log("hola");

                    // Actualizar el campo de selección de clientes en el formulario de creación del proyecto
                    var nuevoClienteOption = $('<option>', { value: response.id, text: response.nombre });
                    $('#form_cliente').append(nuevoClienteOption);

                    // Cerrar el modal después de guardar el cliente
                    $('#nuevoClienteModal').modal('hide');
                    
                    // Redirigir a la página de crear nuevo proyecto
                    window.location.href = '{{ path('app_proyectos_new') }}';

                },
                error: function(xhr, status, error) {
                    // Manejar errores de la solicitud AJAX
                    console.error('Error al guardar el nuevo cliente:', error);
                }
            });
        });
    });
</script>
